#!/bin/python3

import os, sys

# cc -S outputs asm
# -static

MAIN_FNAME = "main.c"
SRC_PATH   = "lib/src"
OUT_FNAME  = "outp"

COMPILE_FLAGS = "-ffreestanding -fno-builtin -static -masm=intel -nostdlib"

CMD = f"cc {COMPILE_FLAGS} {MAIN_FNAME} {SRC_PATH}/*"
print(CMD)

if len(sys.argv) > 1:
	match sys.argv[1]:
		case "debug":
			os.system(f"{CMD} -S")
			exit(0)
		case "clean":
			import glob
			for file in glob.glob("./*.s") + [f"./{OUT_FNAME}"]:
				os.remove(file)
			exit()
		case _:
			print("huh")
			exit(-43)
else:
	if os.system(f"{CMD} -o {OUT_FNAME}") == 0:
		# run prog
		print("starting program:\n")
		print("----------------")
		x = os.system(f"./{OUT_FNAME}")
		print()
		print("----------------")
		print("\nfinished running\nexited with code " + str(x))
		exit(x)